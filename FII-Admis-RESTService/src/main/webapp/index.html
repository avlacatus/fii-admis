<!DOCTYPE HTML>
<html>
<head>	

	<title>FII Admis Admin Panel</title>

	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">	
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link href="./css/bootstrap.min.css" rel="stylesheet" media="screen">
	<link href="./css/main.css" rel="stylesheet" type="text/css" />

	<script>

		var currentAction = "none";
		var currentCandidateId = -1;

		var getCandidatesLink = "http://fii-admis-restservice-dt5dd3kc2v.elasticbeanstalk.com/api/candidates";
		var updateCandidate = "http://fii-admis-restservice-dt5dd3kc2v.elasticbeanstalk.com/api/candidates";
		var newCadidateLink = "http://fii-admis-restservice-dt5dd3kc2v.elasticbeanstalk.com/api/candidates";
		var deleteCandidateLink = "http://fii-admis-restservice-dt5dd3kc2v.elasticbeanstalk.com/api/candidates";

		var candidates;

	</script>

</head>
<body>

	<div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">          
          <a class="brand" href="#">FII Admis</a>          
        </div>
      </div>
    </div>

    <div class="container">

		<ul id="candidate-list">
		</ul>

		<button id="add-new-candidate">Add new</button>
		<button id="compute-results">Compute Results</button>
		<div id="edit-box" class="hidden">

			<form id="user-input">

				<div class="first-name-elem">First name:</div> <input type="text" name="firstname"><br>
				<div class="first-name-elem">Last name:</div> <input type="text" name="lastname"><br>
				<div class="first-name-elem">Gpa grade:</div> <input type="number" min="1" max="10" step="0.01" name="gpagrade"><br>
				<div class="first-name-elem">A Test Grade:</div> <input type="number" min="1" max="10" step="0.01" name="atestgrade"><br>
				<div class="first-name-elem">Social Id:</div> <input type="text" pattern="[0-9]{13}" maxlength="13" name="socialid"><br>

				<input id="button-submit" type="submit" value="Create">
				<input id="button-cancel" type="submit" value="Cancel">

			</form>

		</div>

	</div>

	<script src="./js/jquery.js"></script>
	<script src="./js/jquery-ui-1.10.4.min.js"></script>	
	<script src="js/bootstrap.min.js"></script>

	<script type="text/javascript">
		$(document).ready(function () {
			getCandidatesFromServer();
			//getResults();

			$("#add-new-candidate").click(function() {
				currentAction = "create";
				$("#edit-box").show();	
				$("#button-submit").attr("value", "Create");

				$("#user-input input[type=text]").val("");				
			});

			$("#button-submit").click(function(x) {
				x.preventDefault();
				submitButtonPressed();
			});

			$("#button-cancel").click(function(x) {
				x.preventDefault();
				$("#edit-box").hide();
			});

			$("#compute-results").click(function() {					 
				$.ajax({
					type: "GET",
					url: updateCandidate + "/" + currentCandidateId,				
					beforeSend: function (request) {
                		request.setRequestHeader("Pragma", "admin");
            		}
				}).done(function( data ) {
					alert("Results computed!");
				});    	
			});
	       
	    });

		function getCandidatesFromServer() {
			// Create header
			var candidatesHeader = new Object();
		    candidatesHeader.id = "ID";
		    candidatesHeader.firstName = "First Name";
		    candidatesHeader.lastName = "Last Name";
		    candidatesHeader.gpaGrade = "GPA grade";
		    candidatesHeader.ATestGrade = "ATest Grade";
		    candidatesHeader.socialId = "Social Id";
		    candidatesHeader.actions = "Actions";
		    addCandidateToList(candidatesHeader, true, 0)

		    // Gets the candidates from the server
		    $.ajax({
				type: "GET",
				dataType: "json",
				url: getCandidatesLink,

				statusCode: {
					200: function() {
						//alert("ok");
					},
					404: function() {
						//alert( "page not found" );
					},
				}
			}) .done(function( data ) {
				parseJsonFile(data);
			});
			/*
		    parseJsonFile(jQuery.parseJSON('{"candidates":[{"id":"Aa2I","lastName":"Popescu","gpaGrade":9.3,"ATestGrade":8.9,"socialId":"347389523255435","firstName":"Ionut"},{"id":"vr6U","lastName":"Popescu","gpaGrade":9.3,"ATestGrade":8.9,"socialId":"347389523255435","firstName":"Ionut"},{"id":"Nxa7","lastName":"Popescu","gpaGrade":9.3,"ATestGrade":8.9,"socialId":"347389523255435","firstName":"Ionut"},{"id":"vvch","lastName":"Jolie","gpaGrade":9.3,"ATestGrade":8.9,"socialId":"347389523255435","firstName":"Angelina"},{"id":"WSEd","lastName":"Jolie","gpaGrade":9.3,"ATestGrade":8.9,"socialId":"347389523255435","firstName":"Angelina"},{"id":"PmbP","lastName":"Jolie","gpaGrade":9.3,"ATestGrade":8.9,"socialId":"347389523255435","firstName":"Angelina"}]}'));*/
		}

	    function parseJsonFile(json) {	    	
	    	arrayLength = json.candidates.length;
	    	for (var i = 0; i < arrayLength; i++) {
	    		addCandidateToList(json.candidates[i], false, i);
	    	}
	    	candidates = json.candidates;
	    }	    

	    function getResults() {
	    	results = jQuery.parseJSON('{"admissionResults":[{"id":"XvsG","finalGrade":9.77,"candidateId":"MZOp","admissionStatus":{"statusString":"tax_free","statusInt":0}},{"id":"V7RQ","finalGrade":9.615,"candidateId":"fQak","admissionStatus":{"statusString":"tax_free","statusInt":0}},{"id":"NZBR","finalGrade":9.615,"candidateId":"NuUI","admissionStatus":{"statusString":"tax_free","statusInt":0}},{"id":"6f9H","finalGrade":9.49,"candidateId":"Ssi6","admissionStatus":{"statusString":"tax_free","statusInt":0}},{"id":"CLzC","finalGrade":9.27,"candidateId":"mjgQ","admissionStatus":{"statusString":"tax_free","statusInt":0}},{"id":"vGoH","finalGrade":9.100000000000001,"candidateId":"hHAg","admissionStatus":{"statusString":"tax_free","statusInt":0}},{"id":"KKSw","finalGrade":9,"candidateId":"j21y","admissionStatus":{"statusString":"tax_free","statusInt":0}},{"id":"CfJs","finalGrade":8.965,"candidateId":"75us","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"k5rG","finalGrade":8.86,"candidateId":"DBvh","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"CEeZ","finalGrade":8.675,"candidateId":"aDZl","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"AQ0T","finalGrade":8.645,"candidateId":"uG6A","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"pRsY","finalGrade":8.605,"candidateId":"ltCs","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"jNwO","finalGrade":8.395,"candidateId":"UxCK","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"Co3D","finalGrade":8.395,"candidateId":"RBd2","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"96yc","finalGrade":8.215,"candidateId":"vpt7","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"8LnY","finalGrade":8.175,"candidateId":"z5p1","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"QkTX","finalGrade":8.17,"candidateId":"UEuJ","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"vajx","finalGrade":8.06,"candidateId":"sOed","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"ZgC9","finalGrade":8.01,"candidateId":"zmSd","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"abhF","finalGrade":7.965,"candidateId":"8ixA","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"hbyI","finalGrade":7.9,"candidateId":"Fitl","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"zlNx","finalGrade":7.8549999999999995,"candidateId":"2qWs","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"Kzjp","finalGrade":7.73,"candidateId":"ff5r","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"F0v7","finalGrade":7.67,"candidateId":"SyXY","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"BxWT","finalGrade":7.65,"candidateId":"bmVg","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"I7d5","finalGrade":7.625,"candidateId":"OSM9","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"nJms","finalGrade":7.115,"candidateId":"Uo9y","admissionStatus":{"statusString":"tax","statusInt":1}},{"id":"KeGE","finalGrade":6.975,"candidateId":"Xgej","admissionStatus":{"statusString":"rejected","statusInt":2}},{"id":"3BfB","finalGrade":6.9,"candidateId":"2OGp","admissionStatus":{"statusString":"rejected","statusInt":2}},{"id":"6ap8","finalGrade":6.675,"candidateId":"ovYU","admissionStatus":{"statusString":"rejected","statusInt":2}},{"id":"8uli","finalGrade":6.45,"candidateId":"Sf1c","admissionStatus":{"statusString":"rejected","statusInt":2}}]}');

	    	parseResults(results);
	    }

	    function parseResults(json) {
	    	arrayLength = json.admissionResults.length;
	    	for (var i = 0; i < arrayLength; i++) {
	    		var candidateId = json.admissionResults[i].candidateId;
	    		var finalGrade = json.admissionResults[i].finalGrade;
	    		var resultState = json.admissionResults[i].admissionStatus.statusString;

	    		addResultToCandidate(candidateId, finalGrade, resultState);
	    	}
	    }

	    function addResultToCandidate(candidateId, finalGrade, resultState) {
	    	for (var i = 0; i < candidates.length; i++) {
	    		if (candidates[i].id == candidateId) {
	    			candidates[i].finalGrade = finalGrade;
	    			candidates[i].resultState = resultState;
	    			break;
	    		}
	    	}
	    }

	    function addCandidateToList(candidate, isFirst, id) {
	    	idElem = $("<div></div>")
	    		.attr("class", "id-elem")
	    		.html(candidate.id);

	    	firstNameElem = $("<div></div>")
	    		.attr("class", "first-name-elem")
	    		.html(candidate.firstName);

	    	lastNameElem = $("<div></div>")
	    		.attr("class", "last-name-elem")
	    		.html(candidate.lastName);

	    	gpaGradeElem = $("<div></div>")
	    		.attr("class", "gpa-grade-elem")
	    		.html(candidate.gpaGrade);

	    	aTestGradeElem = $("<div></div>")
	    		.attr("class", "atest-grade-elem")
	    		.html(candidate.ATestGrade);

	    	socialIdElem = $("<div></div>")
	    		.attr("class", "social-id-elem")
	    		.html(candidate.socialId);

	    	actions = "Actions";
	    	if (!isFirst) {
	    		actions = "";
	    		actions += "<a href='#' onclick='editCandidate(" + id + ");'>Edit</a> ";
	    		actions += "<a href='#' onclick='deleteUser(" + id + ")'>Delete</a>";
	    	}

	    	actionsElem = $("<div></div>")
	    		.attr("class", "actions-elem")
	    		.html(actions);

	    	elem = $("<li></li>")
	    		.append(idElem)
	    		.append(firstNameElem)
	    		.append(lastNameElem)
	    		.append(gpaGradeElem)
	    		.append(aTestGradeElem)
	    		.append(socialIdElem)
	    		.append(actionsElem);

	    	if (isFirst) {
	    		elem.attr("class", "header");
	    	}

	    	$("#candidate-list").append(elem);
	    }

	    function submitButtonPressed() {
	    	if (currentAction == "create") {
	    		addNewCandidate();
	    	}

	    	if (currentAction == "edit") {
	    		editCandidateCommit();
	    	}
	    }

	    function addNewCandidate() {
		    $.ajax({
				type: "POST",
				url: newCadidateLink,				
				data: getValuesFromForm()
			}).done(function( data ) {
				alert("Candidate added");
			});
		    currentAction = "none";
	    }

	    function editCandidate(id) {
	    	currentAction = "edit";
			$("#edit-box").show();	
			$("#button-submit").attr("value", "Edit");

			var c = candidates[id];
			currentCandidateId = id;

			$("[name=firstname]").val(c.firstName);
			$("[name=lastname]").val(c.lastName);
			$("[name=gpagrade]").val(c.gpaGrade);
			$("[name=atestgrade]").val(c.ATestGrade);
			$("[name=socialid]").val(c.socialId);
	    }

	    function editCandidateCommit() {	  
	    	$.ajax({
				type: "PUT",
				url: updateCandidate + "/" + currentCandidateId,				
				data: getValuesFromForm()
			}).done(function( data ) {
				alert("Candidate modified");
			});
	    	currentAction = "none";
	    }

	    function getValuesFromForm() {
	    	var $inputs = $("#user-input :input");
		 
		    var values = {};
		    $inputs.each(function() {
		        values[this.name] = $(this).val();
		    });

		    json = '{"lastName":"' + values.lastname + '",' +
		    		'"gpaGrade":' + values.gpagrade + "," +
		    		'"ATestGrade":' + values.atestgrade + "," + 
		    		'"firstName":"' + values.firstname + '",' + 
		    	    '"socialId":"' + values.socialid + '"}';

		   	return json;
	    }

	    function deleteUser(id) {
	    	if (confirm("Are you sure you want to delete this user?")) {
	    		$("#candidate-list").empty();
	    		getCandidatesFromServer();
				$.ajax({
					type: "DELETE",
					url: updateCandidate + "/" + currentCandidateId,				
				}).done(function( data ) {
					alert("Candidate deleted");
					// request la useri
				});    
			} else {
			}
	    }
	</script>


</body>
</html>